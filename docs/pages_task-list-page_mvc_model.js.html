<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/task-list-page/mvc/model.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/task-list-page/mvc/model.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {EventBus} from "../../../services/eventBus";
import Firebase from "../../../services/firebase";
import Notification from "../../../components/notifications/index";

/**
 * @module TaskListModel
 * */
export class Model{
  /**
   * Initialize data and tasksToRemove fields
   * @param {array} data - array of the tasks data
   * */
    constructor(data){
        this.data = data;
        this.tasksToRemove = [];

        EventBus.add("setData", this.setData, this);
        EventBus.add("setTasksToRemove", this.setTasksToRemove, this);
        EventBus.add("getRemovedTaskLength", this.getRemovedTasksLength, this);
        EventBus.add("removeImmediate", this.removeTasks, this);
    }

    /**
     * Returns a length of the tasksToRemove array
     * @return {number} tasksToRemove array length
     * */
    getRemovedTasksLength(){
        return this.tasksToRemove.length;
    }

    /**
     * Adds task to the tasksToRemove array
     * @param {string} id - task id
     * @param {string} type - task type
     * */
    setTasksToRemove(id, type){
        let existedTask = this.tasksToRemove.indexOf(id);
        if(existedTask !== -1 || (existedTask !== -1 &amp;&amp; type &amp;&amp; type === "deselect")) this.tasksToRemove.splice(existedTask, 1);
        if(existedTask === -1 || (existedTask === -1 &amp;&amp; type &amp;&amp; type === "select")) this.tasksToRemove.push(id);
    }

    /**
     * Removes all tasks which id's are in the tasksToRemove array
     * */
    removeTasks(){
        for(let i = 0; i &lt; this.tasksToRemove.length; i++){
            for(let j = 0; j &lt; this.data.length; j++){
                if(this.tasksToRemove[i] == this.data[j].id) {
                    this.data.splice(j, 1);
                    Firebase.removeData(this.tasksToRemove[i]).then(() => {
                        Notification().showMessage("success", "Task was successfully removed!");
                    }).catch((err) => {
                        Notification().showMessage("error", "Oops! Error was occurred! " + err.message);
                    });
                    break;
                }
            }
        }
        this.tasksToRemove = [];
    }

    /**
     * Adds new tasks or modify the existing one
     * @param {object} data - task data
     * */
    setData(data){
        if(data.startDate){
            if(
                this.data.filter((task) => {
                    return task.startDate &amp;&amp; task.isActive !== false;
                }
                ).length >= 5){
                Notification().showMessage("note", "Max number of tasks for today!");
                return;
            }
        }

        let index;

        this.data.forEach((task, i) => {
            if(task.id === data.id) index = i;
        });

        if(index !== undefined){
            this.data[index] = {...this.data[index], ...data};
            EventBus.dispatch("stateChange");
            Firebase.updateValue(data).then(() => {
                Notification().showMessage("success", "Task was successfully updated!");
            }).catch((err) => {
                Notification().showMessage("error", "Oops! Error was occurred! " + err.message);
            });
        }
        else{
            this.data.push(data);
            Firebase.setValue(data).then(() => {
                Notification().showMessage("success", "Task was successfully added!");
            }).catch((err) => {
                Notification().showMessage("error", "Oops! Error was occurred! " + err.message);
            });
        }
    }

    /**
     * Filters and returns tasks data
     * @param {string} filter - string to filter tasks array
     * @return {array} filtered tasks array
     * */
    getData(filter){
        let requiredData = this.data;
        if(filter){
            for(let key in filter){
                requiredData = requiredData.filter((task) => {
                    if(key === "isActive" || typeof task[key] === "string" &amp;&amp; typeof filter[key] === "string"){
                        return filter[key] == task[key];
                    }
                    return !!filter[key] == !!task[key];
                });
            }
        }
        return requiredData;
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Header.html">Header</a></li><li><a href="module-Notification.html">Notification</a></li><li><a href="module-ReportsPage.html">ReportsPage</a></li><li><a href="module-ReportsPageController.html">ReportsPageController</a></li><li><a href="module-ReportsPageModel.html">ReportsPageModel</a></li><li><a href="module-ReportsPageView.html">ReportsPageView</a></li><li><a href="module-Router.html">Router</a></li><li><a href="module-SettingsPageView.html">SettingsPageView</a></li><li><a href="module-SingleTask.html">SingleTask</a></li><li><a href="module-SingleTaskController.html">SingleTaskController</a></li><li><a href="module-SingleTaskModel.html">SingleTaskModel</a></li><li><a href="module-SingleTaskView.html">SingleTaskView</a></li><li><a href="module-TaskList.html">TaskList</a></li><li><a href="module-TaskListController.html">TaskListController</a></li><li><a href="module-TaskListModel.html">TaskListModel</a></li><li><a href="module-TaskListView.html">TaskListView</a></li><li><a href="module-TimerComponent.html">TimerComponent</a></li><li><a href="module-TimerComponentController.html">TimerComponentController</a></li><li><a href="module-TimerComponentModel.html">TimerComponentModel</a></li><li><a href="module-TimerComponentView.html">TimerComponentView</a></li></ul><h3>Classes</h3><ul><li><a href="module-ReportsPageController.Controller.html">Controller</a></li><li><a href="module-ReportsPageModel.Model.html">Model</a></li><li><a href="module-ReportsPageView.View.html">View</a></li><li><a href="module-Router.Router.html">Router</a></li><li><a href="module-SingleTaskController.Controller.html">Controller</a></li><li><a href="module-SingleTaskModel.Model.html">Model</a></li><li><a href="module-SingleTaskView.View.html">View</a></li><li><a href="module-TaskListController.Controller.html">Controller</a></li><li><a href="module-TaskListModel.Model.html">Model</a></li><li><a href="module-TaskListView.View.html">View</a></li><li><a href="module-TimerComponentController.Controller.html">Controller</a></li><li><a href="module-TimerComponentModel.Model.html">Model</a></li><li><a href="module-TimerComponentView.View.html">View</a></li><li><a href="Setting.html">Setting</a></li></ul><h3>Namespaces</h3><ul><li><a href="EventBus.html">EventBus</a></li><li><a href="Firebase.html">Firebase</a></li><li><a href="HeaderHelpers.html">HeaderHelpers</a></li><li><a href="SettingPageController.html">SettingPageController</a></li><li><a href="TooltipPlugin.html">TooltipPlugin</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jan 16 2018 01:51:34 GMT+0200 (EET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
