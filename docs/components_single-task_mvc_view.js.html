<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/single-task/mvc/view.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/single-task/mvc/view.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import "../template/helpers";
import Template from "../template/template.hbs";
import {Controller} from "./controller";
import uuid from "uuid/v1";
import {EventBus} from "../../../services/eventBus";
import MainHeader from "../../../components/header/index";

/**
 *@module SingleTaskView
 */
export class View {
    /**
     * Initialize controller, type and uuid fields
     * @param {object} data - single task data
     * @param {string} type - type of the task(today, global)
     */
    constructor(data, type){
        this.controller = new Controller(data);
        this.type = type;

        this.uuid = uuid();

        document.body.addEventListener("click", this.viewControl.bind(this));
    }

    /**
     * Collects data, tells the controller to add the data to the model and render template
     */
    handleSubmit(e){
        e.preventDefault();

        let newTask = {
            title: document.querySelector("#edit-modal [data-name=title]").value,
            description: document.querySelector("#edit-modal [data-name=description]").value,
            deadline: Date.parse(document.querySelector("#edit-modal [data-name=deadline]").value),
            estimationTotal: document.querySelectorAll(".radio-block__radio_filled").length - 3
        };
        if(newTask.description === "" || newTask.title === "" || newTask.deadline === ""){
            if(document.querySelector("#edit-modal [name=category]:checked") === null || document.querySelector("#edit-modal [name=priority]:checked") === null)
                return;
        }
        newTask.categoryId = document.querySelector("#edit-modal [name=category]:checked").value;
        newTask.priority = document.querySelector("#edit-modal [name=priority]:checked").value;

        this.controller.sendData(newTask);

        this.render(this.controller.receiveData());
    }

    /**
     *Tells the controller to remove current task
     */
    handleImmediateRemove(e){
        e.preventDefault();

        this.controller.immediateRemove();
    }

    /**
     *Event handler that fires when user clicks on some elements on the page and change the page
     */
    viewControl(e){
        let target = e.target;
        const modalsArticle = document.getElementById("modals-article"),
            currentModal = document.getElementById("edit-modal"),
            data = this.controller.receiveData(),
            parentId = target.parentElement.parentElement.dataset.id;

        if(parentId == data.id &amp;&amp; target.dataset.query === "edit"){
            modalsArticle.style.display = "flex";
            currentModal.classList.add("modal-window__active");

            document.querySelector("[data-query=edit]").addEventListener("click", this.handleSubmit.bind(this));
            document.querySelector("[data-query=immediateRemove]").addEventListener("click", this.handleImmediateRemove.bind(this));
        }

        if(target.dataset.query === "close"){
            e.preventDefault();
            document.querySelector(".modals-article").removeEventListener("click", this.handleSubmit);
            currentModal.style.display = "none";
            modalsArticle.style.display = "none";
        }

        if(parentId == data.id &amp;&amp; target.dataset.query === "push"){
            e.preventDefault();

            this.controller.sendData({startDate: Date.now()});

            this.render(this.controller.receiveData());
        }

        if(target.parentElement.dataset.id == data.id &amp;&amp; target.parentElement.dataset.unique == this.uuid &amp;&amp; target.dataset.query === "addRemove"){
            this.controller.setTaskToRemove();
            target.classList.toggle("single-task__remove-button_active");
        }

        if(target.parentElement.dataset.id == data.id &amp;&amp; target.dataset.query === "timer"){

            MainHeader({hash: "timer"});
            EventBus.dispatch("#timer", data);
        }
    }

    /**
     * Render the SingleTask template with passed data
     * @param  {object} data - task data
     */
    render(data){
        let newData = data || this.controller.receiveData();

        newData.type = this.type;
        newData.unique = this.uuid;

        return Template(newData);
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Header.html">Header</a></li><li><a href="module-Notification.html">Notification</a></li><li><a href="module-ReportsPage.html">ReportsPage</a></li><li><a href="module-ReportsPageController.html">ReportsPageController</a></li><li><a href="module-ReportsPageModel.html">ReportsPageModel</a></li><li><a href="module-ReportsPageView.html">ReportsPageView</a></li><li><a href="module-Router.html">Router</a></li><li><a href="module-SettingsPageView.html">SettingsPageView</a></li><li><a href="module-SingleTask.html">SingleTask</a></li><li><a href="module-SingleTaskController.html">SingleTaskController</a></li><li><a href="module-SingleTaskModel.html">SingleTaskModel</a></li><li><a href="module-SingleTaskView.html">SingleTaskView</a></li><li><a href="module-TaskList.html">TaskList</a></li><li><a href="module-TaskListController.html">TaskListController</a></li><li><a href="module-TaskListModel.html">TaskListModel</a></li><li><a href="module-TaskListView.html">TaskListView</a></li><li><a href="module-TimerComponent.html">TimerComponent</a></li><li><a href="module-TimerComponentController.html">TimerComponentController</a></li><li><a href="module-TimerComponentModel.html">TimerComponentModel</a></li><li><a href="module-TimerComponentView.html">TimerComponentView</a></li></ul><h3>Classes</h3><ul><li><a href="module-ReportsPageController.Controller.html">Controller</a></li><li><a href="module-ReportsPageModel.Model.html">Model</a></li><li><a href="module-ReportsPageView.View.html">View</a></li><li><a href="module-Router.Router.html">Router</a></li><li><a href="module-SingleTaskController.Controller.html">Controller</a></li><li><a href="module-SingleTaskModel.Model.html">Model</a></li><li><a href="module-SingleTaskView.View.html">View</a></li><li><a href="module-TaskListController.Controller.html">Controller</a></li><li><a href="module-TaskListModel.Model.html">Model</a></li><li><a href="module-TaskListView.View.html">View</a></li><li><a href="module-TimerComponentController.Controller.html">Controller</a></li><li><a href="module-TimerComponentModel.Model.html">Model</a></li><li><a href="module-TimerComponentView.View.html">View</a></li><li><a href="Setting.html">Setting</a></li></ul><h3>Namespaces</h3><ul><li><a href="EventBus.html">EventBus</a></li><li><a href="Firebase.html">Firebase</a></li><li><a href="HeaderHelpers.html">HeaderHelpers</a></li><li><a href="SettingPageController.html">SettingPageController</a></li><li><a href="TooltipPlugin.html">TooltipPlugin</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jan 16 2018 01:51:34 GMT+0200 (EET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
